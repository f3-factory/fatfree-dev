server {
  listen 8082;
  http2 on;
  server_name localhost;
  location / {
    root /usr/share/nginx/html;
    index index.php index.html index.htm;
    try_files $uri /index.php?$query_string;
  }
  location ~ \.php$ {
    root           html;
    fastcgi_pass   f3-php82:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
  }
  location ~ /\.ht {
    deny all;
  }
}
server {
  listen 5082 ssl;
  http2 on;
  server_name localhost;
  ssl_certificate /etc/nginx/selfsigned.crt;
  ssl_certificate_key /etc/nginx/selfsigned.key;
  ssl_protocols TLSv1.3;
  location / {
    root /usr/share/nginx/html;
    index index.php index.html index.htm;
    try_files $uri /index.php?$query_string;
  }
  location ~ \.php$ {
    root           html;
    fastcgi_pass   f3-php82:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
    fastcgi_param  SERVER_PROTOCOL    HTTP/2.0;
  }
  location ~ /\.ht {
    deny all;
  }
}

upstream upstream_backend_php84swoole {
  server f3-php84swoole:9501;
}

map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
  listen 8184;
  server_name localhost;

  index index.php index.html index.htm;
  charset utf-8;

  location ~* \.(jpg|jpeg|png|gif|svg|webp|html|txt|json|ico|css|js)$ {
    root /usr/share/nginx/html;
	expires 1d;
	add_header Cache-Control public;
	access_log off;
	try_files $uri $uri/ @swoole;
  }

  location / {
	if ($request_method !~ ^(GET|POST|HEAD|OPTIONS|PUT|DELETE)$) {
	  return 405;
	}
	try_files $uri $uri/ @swoole;
  }

  location @swoole {
    set $suffix "";
	if ($uri = /index.php) {
	  set $suffix ?$query_string;
	}
	proxy_http_version 1.1;
	proxy_set_header Http_Host $http_host;
	proxy_set_header Host $host;
	proxy_set_header SERVER_NAME $host;
	proxy_set_header Scheme $scheme;
	proxy_set_header SERVER_PORT $server_port;
	proxy_set_header REMOTE_ADDR $remote_addr;
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
	proxy_set_header Upgrade $http_upgrade;
	proxy_set_header Connection $connection_upgrade;
	proxy_set_header X-Real-IP $remote_addr;
	proxy_pass http://upstream_backend_php84swoole$suffix;
  }
}

server {
  listen 8083;
  http2 on;
  server_name localhost;
  location / {
    root /usr/share/nginx/html;
    index index.php index.html index.htm;
    try_files $uri /index.php?$query_string;
  }
  location ~ \.php$ {
    root           html;
    fastcgi_pass   f3-php83:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
  }
  location ~ /\.ht {
    deny all;
  }
}


server {
  listen 8284;
  http2 on;
  server_name localhost;
  location / {
    root /usr/share/nginx/html;
    index index.php index.html index.htm;
    try_files $uri /index.php?$query_string;
  }
  location ~ \.php$ {
    root           html;
    fastcgi_pass   f3-php84rr:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
  }
  location ~ /\.ht {
    deny all;
  }
}

server {
  listen 8084;
  http2 on;
  server_name localhost;
  location / {
    root /usr/share/nginx/html;
    index index.php index.html index.htm;
    try_files $uri /index.php?$query_string;
  }
  location ~ \.php$ {
    root           html;
    fastcgi_pass   f3-php84:9000;
    fastcgi_index  index.php;
    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include        fastcgi_params;
  }
  location ~ /\.ht {
    deny all;
  }
}